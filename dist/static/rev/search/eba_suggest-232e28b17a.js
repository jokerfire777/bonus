ebates.suggest=function(e){if(e.url){var t=e.url.toLowerCase().indexOf("suggest");-1!=t&&(e.url=e.url.substr(0,t)+"search/")}var a,n,s=e.input,o=e.justLoadAll||!1,i=new ebates.cache(100),l=document.location.protocol+"//"+e.url,r=s.parent(),c=o&&"click"||"mousedown",d={url:l,dataType:"jsonp",jsonp:"json.wrf",data:{fl:"d:storeId,n:storeName,c:storeCashBack,[cbreplace],e:enableStoreOnlySearch"}},u=e.timeout||2e3,f=e.timeout||300,p=new ebates.cache(100),h=s.attr("placeholder"),g=e.click||function(){x()&&$.ajax({type:"GET",url:"suggestHref.htm",data:{storeId:$(this).attr("data-id"),q:v.attr("data-q"),position:$(this).index()+1},dataType:"text",timeout:u}).done(function(e){/</.test(e)&&(window.location=e.trim())})},m=e.allResLinkText&&$("<li>").addClass("see-all").append($("<a>").text(e.allResLinkText).addClass("prox-b")).on("mousedown",e.allClick||function(){x()&&$(this).parents("form")[0].submit()})||$(""),v=$("<div>").addClass(e.classes).append($("<ul>")).hide().on(c,".suggestion",g).css({left:s.position().left,top:s.position().top+s.height()}),b=function(e){var t=i.get(e),a=function(t){var a;if(Date.now()-this>u)return void r.removeClass("loading");(a=t&&t.response&&t.response.docs)&&(a.length&&w(a,e)&&s.trigger("s-loaded")&&i.set(a,e)||p.set(!0,e)&&C(1))};return r.addClass("loading"),t&&t.length&&w(t,e)||!t&&$.ajax($.extend(!0,d,{data:{q:e,rows:10,targetSet:$("#targetcashbackset").val()}})).done(a.bind(Date.now()))||C(1),!0},w=function(e,t){var a,n=[],i=function(e){var a=new RegExp("("+t+")","gi");return e.replace(a,'<span class="prox-b">$1</span>')};if(setTimeout(function(){r.removeClass("loading")},50),t!==T(s.val()))return!0;for(m.detach(),a=0;a<e.length;a++)"13692"===e[a].d?n.push('<li class="suggestion',e[a].e&&" direct"||"",'" data-id="',e[a].d,'"><span class="store-name">',e[a].n,'</span><span class="cashback prox-b chaitu cb-blue">',lyftCB||"","</span></li>"):n.push('<li class="suggestion',e[a].e&&" direct"||"",'" data-id="',e[a].d,'"><span class="store-name">',e[a].n,'</span><span class="cashback prox-b chaitu cb-blue">',e[a].c,"</span></li>");return v.find("ul").html(n.join("")).append(m).end().show().attr("data-q",t),!o&&v.find(".store-name").each(function(){$(this).html(i($(this).text()))}),!0},C=function(e){return n=setTimeout(function(){v.hide(),r.removeClass("loading")},e||300),!0},x=function(){return r.addClass("loading"),setTimeout(function(){clearTimeout(n)},150)},T=function(e){return e.trim().replace(/[^\w\s&'$.]+/g,"").replace(/^\W+/g,"").replace(/\s+/g," ").toLowerCase()},k=function(e){var t,a=v.find("li.selected"),n=v.find("li").length,s=e||1;v.is(":visible")&&(a.length&&a.removeClass("selected")&&v.find("li:eq( "+(a.index()+s)%n+" )").addClass("selected")||v.find("li:eq(0)").addClass("selected"),a=v.find("li.selected"),((t=v.offset().top-a.offset().top)>=0||t<-v.height()+a.height())&&v.stop(!0,!1).animate({scrollTop:"+="+(.5*-v.height()-t)}))},j={40:k,38:function(){k(-1)},13:function(){var e=v.find("li.selected");return!e.is(":visible")||(e.hasClass("see-all")&&e.trigger("click")||e.trigger(c))&&!1}};!o&&s.val(""),s.after(v).attr("autocomplete","off").focus().on("input propertychange",function(){a&&clearTimeout(a),a=setTimeout(function(){var e=T(s.val());e&&!p.get(e)&&b(e)||C(1)},f)}).one("s-loaded",function(){s.on("blur",function(){C()&&!o&&""===s.val()&&s.val(h)})}).on("focus",function(){!o&&s.val()===h&&s.val(""),T(s.val())===v.attr("data-q")&&v.show()}).on("keydown",function(e){return j[e.which]&&j[e.which].call(null)})};
//# sourceMappingURL=eba_suggest-232e28b17a.js.map
