ebates.suggest=function(e){"";"use strict";var s=$(".h-search-form button"),t=$("#store_name"),n={result:{rows:10,rowsParam:"rows",map:function(e){return e&&e.response&&e.response.docs&&{size:e.response.docs.length,cat:{one:e.response.docs},total:e.response.numFound||0}||{size:0,cat:{}}}},classes:{section:"store-suggest-cont"},params:{query:"q",defs:{},dynamic:function(){return{}}},ajax:{jsonp:"json.wrf"},start:1,clickEvent:"mousedown",caches:{},prepQ:function(e){return e.replace(/\s+/g,"\\")},click:function(){f(),$.get("/ajax/suggest/link.htm",{storeId:$(this).data("id"),q:l.attr("data-q"),position:$(this).index()+1},function(e){window.location=$.trim(e)},"text")},show:function(e,s){var t,n=this,a=[],r=l.find("ul."+n.classes.section);if(setTimeout(function(){c.removeClass("loading")},0),e.cat&&e.cat.one&&e.cat.one.length){for(t=0;t<e.cat.one.length;t++)a.push('<li class="suggestion',e.cat.one[t].e&&" direct"||"",'" data-id="',e.cat.one[t].d,'"><span class="f-14 s-name store-name">',e.cat.one[t].n,'</span><span class="cashback prox-b">',e.cat.one[t].c,"</span></li>");r.html(a.join("")).append('<li class="see-all prox-b"><a href="/search/stores.htm?store_name='+ebates.search.queryFilter(i.val())+'&all=1">See all store results ></a></li>'),l.show().attr("data-q",s),o.highlight&&r.find(".s-name").each(function(){$(this).html(o.highlight(s,$(this).text()))})}else g(n.classes.section);return!0}},a={times:{inputThrottle:150,close:300},classes:{cont:"",highlight:"prox-b"},suggests:$.map(new Array(e.suggests.length),function(){return $.extend(!0,{},n)}),data:{},highlight:function(e,s){var t=new RegExp("("+e.replace(/\\/g,"\\s+")+")","gi");return s.replace(t,'<span class="'+o.classes.highlight+'">$1</span>')}},o=$.extend(!0,a,e),i=o.input,c=i.parent(),r={query:0,hide:0},l=$("<div>").addClass(o.classes.cont).hide().css({left:i.position().left,top:i.position().top+i.height()}),u=function(e,n){return n!==this.prepQ(p(i.val()))||(s.addClass("color-change round3-r-0"),t.addClass("search-focused border-b round3-l-0"),this.show.call(this,e,n))},h=function(e){var s=this,t=s.caches.exact?s.caches.exact.get(e):null,n=function(t){var n=s.result.map(t);i.trigger("pcs-search-event",{action:"be-response-success",q:e,response:t}),n.size?(u.call(s,n,e),i.trigger("s-loaded"),s.caches.exact&&s.caches.exact.set(n,e)):(s.caches.empty&&s.caches.empty.set(!0,e),g(s.classes.section))};return t?u.call(s,t,e):function(e,t,n){c.addClass("loading"),s.params.defs[s.result.rowsParam]=t,s.params.defs[s.params.query]=e,$.ajax($.extend(s.ajax,{data:$.extend({},s.params.defs,s.params.dynamic())})).done(n).always(function(){c.removeClass("loading")})}(e,s.result.rows,n),!0},d=function(e){return r.hide=setTimeout(function(){l.hide&&l.hide(),c.removeClass("loading")},e),!e&&l.find("ul").html(""),!e&&s.removeClass("color-change round3-r-0"),!e&&t.removeClass("search-focused border-b round3-l-0"),!0},g=function(e){c.removeClass("loading"),l.find("ul."+e).html(""),!l.find("li.suggestion").length&&d(0),!l.find("li.suggestion").length&&s.removeClass("color-change round3-r-0"),!l.find("li.suggestion").length&&t.removeClass("search-focused border-b round3-l-0")},f=function(){return c.addClass("loading"),setTimeout(function(){clearTimeout(r.hide)},o.times.inputThrottle)},p=function(e){return $.trim(e).replace(/[^\w\s&'$.]+/g,"").replace(/^\W+/g,"").toLowerCase()},m=function(e){var s,t,n,a=l.find("li.selected").removeClass("selected"),o=e||1;l.is(":visible")&&(s=l.find("li.suggestion, li.see-all"),t=s.length,a.length&&s.eq((a.index("li.suggestion, li.see-all")+o)%t).addClass("selected")||(a=s.eq(0).addClass("selected")),((n=l.offset().top-a.offset().top)>=0||n<-l.height()+a.height())&&l.stop(!0,!1).animate({scrollTop:"+="+(.5*-l.height()-n)}))},v={40:m,38:function(){m(-1)},13:function(){var e=l.find("li.selected"),s=e.find("a");return!e.is(":visible")||(s.length&&s[0].click()||e.trigger(e.parent().attr("data-click-event")))&&!1}},x=function(){i.hasClass("search-suggest-off")||(clearTimeout(r.query),r.query=setTimeout(function(){var e=p(i.val());e&&$.each(o.suggests,function(){var s=this.prepQ(e);!(s.length>=this.start)||this.caches.empty&&this.caches.empty.get(s)?g(this.classes.section):h.call(this,s)})||d(0)},o.times.inputThrottle))};$.each(o.suggests,function(){l.append($(['<ul class="',this.classes.section,'" data-click-event="',this.clickEvent,'"></ul>'].join(""))).on(this.clickEvent,"."+this.classes.section+" .suggestion",this.click),!this.ajax.dataType&&(this.ajax.dataType="jsonp"),"jsonp"!==this.ajax.dataType&&delete this.ajax.jsonp}),i.after(l).attr("autocomplete","off").focus().on("input",x).one("s-loaded",function(){i.on("blur",function(){d(o.times.close),s.removeClass("color-change round3-r-0"),t.removeClass("search-focused border-b round3-l-0")})}).on("focus",function(){l.find(".suggestion").length&&l.show(),l.find(".suggestion").length&&s.addClass("color-change round3-r-0"),l.find(".suggestion").length&&t.addClass("search-focused border-b round3-l-0")}).on("keydown",function(e){return v[e.which]&&v[e.which].call(null)}).on("suggest-wait",f).on("clear-suggest",function(){$.each(o.suggests,function(){g(this.classes.section),s.removeClass("color-change round3-r-0"),t.removeClass("search-focused border-b round3-l-0")})})};
//# sourceMappingURL=generic-601e53461b.js.map
